/*!
 * jQuery Pathner
 *
 * Requires:
 * - jQuery v2.0.0
 * - jQuery Popup Window v.1.0.1
 */
!function(a){var e=86400,t="tkn",r="_exp",n=t+r,i="https://partner.path.com/oauth2/authenticate?response_type=code&client_id=",o="about:blank",p="body{padding:0;margin:0}.pathner{font-family:'HelveticaNeue-Light','Helvetica Neue Light','Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif;margin:0;padding:0;margin-bottom:10px}.pathner-body{background:#fff}.pathner-header{background:#e4322e;color:#fff;padding:8px}.pathner-header > img{height:25px;width:25px;margin-left:2px}.pathner-header > span{font-weight:500;font-size:small;position:absolute;top:13px;left:40px;clear:both;-webkit-font-smoothing:antialiased}.pathner-input-area{padding:10px}.pathner-input-area > textarea{background:#f0f0f0;color:#333;margin:0;padding:8px;border:1px solid #C8C8C8;resize:none;width:100%;height:50px;font-weight:200;font-size:small}.pathner-preview-box{padding:10px;padding-top:0}.pathner-preview-box-media{padding:0;margin:0}.pathner-preview-box-media > img{width:100%;padding:0;margin:0;border:0}.pathner-preview-box-caption{border:1px solid #C8C8C8;padding:10px;margin:0;margin-top:-5px}.pathner-preview-box-caption > h4{padding:0;margin:0;margin-bottom:4px;font-weight:700;color:#333;-webkit-font-smoothing:antialiased}.pathner-preview-box-caption > p{padding:0;margin:0;margin-bottom:4px;font-weight:200;font-size:small;text-align:justify;color:#494949;-webkit-font-smoothing:antialiased}.pathner-share-area{padding:10px;padding-top:0}.pathner-share-area > button{background:#61b23d;color:#f2f8f0;margin-top:0;width:100%;border:0;padding:15px;font-weight:400;font-size:14px;-webkit-border-radius:2px 2px 2px 2px;border-radius:2px 2px 2px 2px;-webkit-font-smoothing:antialiased;cursor:pointer}.pathner-share-area > button:active,.pathner-share-area > button:target{background:#448229}.pathner-footer{padding:10px;text-align:center}.pathner-footer > p{color:#afafaf;font-size:small;padding:0;margin:0;-webkit-font-smoothing:antialiased}",c="Share to <strong>Path</strong>",l="Saving...",s=function(){try{localStorage.removeItem(t),localStorage.removeItem(n)}catch(a){return console.log("removeStorage: Error removing key ["+t+"] from localStorage: "+JSON.stringify(a)),!1}return!0},d=function(){var a=Date.now(),e=localStorage.getItem(n);if((void 0===e||null===e)&&(e=0),a>e)return s(),null;try{var r=localStorage.getItem(t);return r}catch(i){return console.log("getStorage: Error reading key ["+t+"] from localStorage: "+JSON.stringify(i)),null}},h=function(a,r){r=void 0===r||null===r?e:Math.abs(r);var i=Date.now(),o=i+1e3*r;try{localStorage.setItem(t,a),localStorage.setItem(n,o)}catch(p){return console.log("setStorage: Error setting key ["+t+"] in localStorage: "+JSON.stringify(p)),!1}return!0},f=function(e,t){var r,n="";t.appname&&(n=t.appname),r=a.isFunction(t.data)?t.data(e):t.data,r=r||{};var i=r.title,o=r.image,l=r.description;return'<!DOCTYPE html><html><head><title>Post to Path</title><meta content="minimal-ui; initial-scale=1.0; maximum-scale=1.0; user-scalable=no; width=320" name="viewport"><meta content="IE=Edge;chrome=1" http-equiv="X-UA-Compatible"><meta charset="utf-8"><style>'+p+'</style></head><body><div class="pathner"><div class="pathner-header"><img class="pathner-icon" src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAMAAAC7m5rvAAAB4FBMVEX////////////////iEwfiFAjiFQniFwvjGAzjGQ3jGQ7jHBHjHRLjHxTkIBXkIRbkIhfkIxjkJRnkJhrkJhvlJxzlKR7lKyDlLSLlLyTmMifmMijmMynmNCrmNSvmNizmNy3nOzHnPDLnPTPnPzboQDfoQTjoQzroRTzoRjzpST/pSkDpS0HpS0LpTEPqUEfqU0rqVEvqVUzqVk3rWFDrWVHrWlLrW1PrXFTrXVXrX1fsYVnsZFzsZF3sZV7sZ2DtamLta2PtbGTucWrucmvudm/venPvfHXvfXfwgnzwg33whH7whX/whoDwh4HwiYPxiYPxioTxjIbxjojxkIrxkYvyk43ylI7ylZDylpHyl5LymZTzmpXznJfznpnzn5rzoJvzoZz0op70paH0pqL0p6P0qKT0qaX1qqb1q6b1raj1rqn1r6v1sKz2sq72tbH2t7P3u7f3vLn3vrv3wb73wr/4xcL4xsP4x8T4x8X4yMb4ycf5ysj5z8z50M3609D61dP61tT619X62df62tj729n73Nr73tz739374N/74eD74uH85OP85+b86Of86un86+r97Ov97e397+798vH+8/L+9PP+9fT+9vX++Pf++fj++fn//Pz//f3//v7///8K5UXTAAAABHRSTlMAh8LDrEhNWQAAAiVJREFUeAHV1utXTFEYx/GpeRRDaSjkHpJk5MIYEalxz10uUYoml0R0QeMiFaYLQ0y51O9fdWY9e7az9jlnZs95xffVzG/tzzpr7VfbY5TjRTZ5czzJcpFtuclvIfuM73ldMK/HAzf9v2z65e2TdXsDVbsOHmt+OqnHEm3BJWQqv/LscEYWP11M1moG0rNIIdlXG0/D6smxwm5HtpPSdc2BHSLZvG2Ndx73dF4OLTO5Flt2l1KVNo1D9LP3CMme2bAZH4kafsHcaDWJls5aWSOJOqB2jkQXrKyEuHsApt5Go29i36W7RFzRrMpeERcG8NXPdz4oXYC4fpVd570YRp+IeyLZRB4vp1TWwPsZGMUX8J8+yEK87FfZPt5fOLA2XtaprIr3cQfWy4vfgY05sH5eylUWNF3V5/kWFuHlsMrCf+8fX3wWVsPLVZW18J73AcDUQpW9I+6jykaIK5sDpov49wBEM6U8VEJlWEvJFvUA+L2cTw2BG1xP3Gsr6yQj/yiSreJT1Q9GviVi3UESHYeVoYIoMMk/yyhVwWKSbYcdG9vcBNEmsqkCVsalY/XIyMpJbXUHMrMNfDafRFsic9BgK/n0nufNJ8JHL3a9B5eB/ShgthsyHTZB3A5tNnQfwE3i6rTZQ9rY2uoj7oo2e0SmhrXZLZPaCm12w8Ri+qyPZO3QZzhAXEkXsmGIng+tWFPbnviHnjMuX3gu35MuX6/u38pu+gOiwQ99UZw9YwAAAABJRU5ErkJggg==" /><span>Post to <strong>Path</strong></span></div><div class="pathner-body"><div class="pathner-input-area"><textarea placeholder="Leave a note..."></textarea></div><div class="pathner-preview-box"><div class="pathner-preview-box-media"><img src="'+o+'" /></div><div class="pathner-preview-box-caption"><h4>'+i+"</h4><p>"+l+'</p></div></div><div class="pathner-share-area"><button id="pathner-share-area-share">'+c+'</button><button id="pathner-share-area-cancel" onclick="self.close();" style="display: none;">Cancel</button></div></div><div class="pathner-footer"><p>'+n+"</p></div></div></body></html>"},u=function(e,t,r){var n=function(e){var t=a(e.document.body).find("textarea");t.width(t.parent().width()-18)},i=function(e,t){t?(a(e).find("#pathner-share-area-share, textarea").attr("disabled","disabled"),a(e).find("#pathner-share-area-share").html(l)):(a(e).find("#pathner-share-area-share, textarea").removeAttr("disabled"),a(e).find("#pathner-share-area-share").html(c))},o=function(t,r){i(t,!0);var n,o=r.action,p=r.method;n=a.isFunction(r.data)?r.data(e):r.data;var c={caption:a(t).find("textarea").val(),title:n.title,image:n.image,url:n.url,description:n.description};a.ajax({type:p,url:o,data:c,beforeSend:function(a){a.setRequestHeader("Authorization",d())},error:function(e,n,o){r.callback&&a.isFunction(r.callback.error)&&r.callback.error(e,n,o),i(t,!1)},success:function(e){var n=function(){a(t).find("#pathner-share-area-cancel").trigger("click")};r.callback&&a.isFunction(r.callback.success)?r.callback.success(e,n):n()}})},p=function(){var i=t.document.body;a(i).html(f(e,r)),a(t).resize(function(){n(t)});var p=setInterval(function(){n(t),clearInterval(p)},2e3);n(t),a(i).find("#pathner-share-area-share").on("click",function(){o(i,r)})};a(t.document).ready(function(){setTimeout(p,100)})},g=function(e,t,r){u(e,a.popupWindow(o,r),t)};a.fn.pathPartner=function(e,t){var e=e||{};return this.each(function(){a(this).on("click",function(){var r=this;if(d())return void g(r,e,t);var n=a.popupWindow(i+e.clientId,t);a(n.document).ready(function(){var t=setInterval(function(){if(a.isFunction(n.location.replace))try{var i=n.location.href;if(i===o)return;var p=JSON.parse(a(n.document.body).text());p.token||n.self.close(),clearInterval(t),h(p.token),n.location.replace(o),u(r,n,e)}catch(c){}},1e3)})})})}}(jQuery);
